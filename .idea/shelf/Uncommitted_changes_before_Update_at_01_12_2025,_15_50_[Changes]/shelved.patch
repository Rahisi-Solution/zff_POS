Index: app/src/main/java/com/rahisi/zffboarding/MainActivity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.rahisi.zffboarding;\n\nimport android.Manifest;\nimport android.app.Dialog;\nimport android.app.ProgressDialog;\nimport android.content.Context;\nimport android.content.DialogInterface;\nimport android.content.Intent;\nimport android.content.SharedPreferences;\nimport android.content.pm.PackageManager;\nimport android.graphics.Color;\nimport android.media.AudioManager;\nimport android.media.MediaPlayer;\nimport android.media.ToneGenerator;\nimport android.os.AsyncTask;\nimport android.os.Build;\n\nimport android.os.Bundle;\nimport android.telephony.TelephonyManager;\nimport android.util.Base64;\nimport android.util.Log;\nimport android.view.Menu;\nimport android.view.MenuInflater;\nimport android.view.MenuItem;\nimport android.view.View;\nimport android.view.Window;\nimport android.widget.Button;\nimport android.widget.EditText;\nimport android.widget.TextView;\nimport android.widget.Toast;\n\nimport androidx.appcompat.app.AlertDialog;\nimport androidx.appcompat.app.AppCompatActivity;\nimport androidx.core.content.ContextCompat;\n\nimport com.android.volley.AuthFailureError;\nimport com.android.volley.DefaultRetryPolicy;\nimport com.android.volley.Request;\nimport com.android.volley.RequestQueue;\nimport com.android.volley.Response;\nimport com.android.volley.VolleyError;\nimport com.android.volley.toolbox.StringRequest;\nimport com.android.volley.toolbox.Volley;\nimport com.honeywell.aidc.BarcodeFailureEvent;\nimport com.honeywell.aidc.BarcodeReadEvent;\nimport com.honeywell.aidc.BarcodeReader;\nimport com.honeywell.aidc.ScannerUnavailableException;\nimport com.honeywell.aidc.TriggerStateChangeEvent;\nimport com.honeywell.aidc.UnsupportedPropertyException;\nimport com.telpo.tps550.api.decode.Decode;\n\nimport org.json.JSONArray;\nimport org.json.JSONException;\nimport org.json.JSONObject;\n\nimport java.text.DateFormat;\nimport java.text.SimpleDateFormat;\nimport java.util.Date;\nimport java.util.HashMap;\nimport java.util.Map;\nimport java.util.Objects;\n\npublic class MainActivity extends AppCompatActivity implements BarcodeReader.BarcodeListener, BarcodeReader.TriggerListener {\n    TextView mOperatorDisplayLabel;\n    TextView mOperatorDisplay;\n    TextView mTicketNumberDisplay;\n    TextView mPassengerNameDisplay, tv_route, tv_time, tv_date, tv_action_performed;\n    EditText mTicketNumberEditor;\n    Button mVerifyTicketButton;\n    Button mSearchTicketButton;\n    Button mLogoutButton;\n    SharedPreferences mSharedPreferences, routeSharedPref;\n    Dialog  manualDialog, childDialog;\n    String mTicketNumber, operator, pin;\n    int mScannedTickets;\n    String qr_departure_date, qr_departure_time, qr_destination, qr_ticket_number, qr_today_date,qr_route,  qr_age, qr_name;\n    private int mTotalTickets;\n    SimpleDateFormat db_date_format = new SimpleDateFormat(\"yyyy-MM-dd\");\n    SimpleDateFormat qr_date_format = new SimpleDateFormat(\"dd MMMM, yyyy\");\n    String today_date;\n    String route_departure_time, route_id, route_name, today;\n    TicketDatabaseAdapter mDatabaseAdapter = new TicketDatabaseAdapter(this);\n\n    private com.honeywell.aidc.BarcodeReader barcodeReader;\n    String action, service_to_call;\n    String mDepartureDate;\n    private Context mContext = MainActivity.this;\n    String result_status;\n    String result_message;\n//    private static final long MAX_SESSION_TIME = 60 * 60 * 1000;\n    private static final long MAX_SESSION_TIME = 60 * 1000;\n\n    private void checkSessionTimeout() {\n        SharedPreferences prefs = mContext.getSharedPreferences(Config.SHARED_PREF_NAME, Context.MODE_PRIVATE);\n        long loginTime = prefs.getLong(\"login_time\", 0);\n        long currentTime = System.currentTimeMillis();\n\n        if (loginTime != 0 && (currentTime - loginTime) >= MAX_SESSION_TIME) {\n            signout();\n        }\n    }\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        Thread.setDefaultUncaughtExceptionHandler(new ExceptionHandler());\n\n        setContentView(R.layout.activity_main);\n\n        mSharedPreferences = MainActivity.this.getSharedPreferences(Config.SHARED_PREF_NAME, Context.MODE_PRIVATE);\n        routeSharedPref = MainActivity.this.getSharedPreferences(Config.ROUTE_SHARED_PREF, Context.MODE_PRIVATE);\n        route_departure_time = routeSharedPref.getString(\"departure_time\", \"NA\");\n        route_id = routeSharedPref.getString(\"route_id\", \"NA\");\n        System.out.println(\"Route id: \" + route_id);\n        route_name = routeSharedPref.getString(\"route_name\", \"NA\");\n        System.out.println(\"Route time: \" + route_departure_time);\n        action = routeSharedPref.getString(\"action\", \"NA\");\n        System.out.println(\"Action: \"  + action);\n\n        tv_action_performed = findViewById(R.id.tv_task_performed);\n        mOperatorDisplayLabel = findViewById(R.id.textViewOperatorLabel);\n        mOperatorDisplay = findViewById(R.id.textViewOperator);\n        mVerifyTicketButton = findViewById(R.id.buttonVerifyTicket);\n        mSearchTicketButton = findViewById(R.id.buttonWriteManual);\n        mLogoutButton = findViewById(R.id.buttonLogout);\n        mTicketNumberDisplay = findViewById(R.id.textViewTicketNumber);\n        mPassengerNameDisplay = findViewById(R.id.textViewPassengerName);\n        mScannedTickets = mSharedPreferences.getInt(Config.SHARED_SCANNED_TICKETS, 0);\n        operator = mSharedPreferences.getString(Config.KEY_OPERATOR, \"NA\");\n        pin = mSharedPreferences.getString(\"pin\", \"NA\");\n//        checkSessionTimeout();\n        mOperatorDisplayLabel.setVisibility(View.INVISIBLE);\n\n        if(Build.MODEL.equals(\"EDA50K\") || Build.MODEL.equals(\"EDA51K\")){\n            mVerifyTicketButton.setVisibility(View.GONE);\n        }\n\n        tv_route = findViewById(R.id.tv_route);\n        tv_time = findViewById(R.id.tv_time);\n        tv_date = findViewById(R.id.tv_date);\n\n        SimpleDateFormat format = new SimpleDateFormat(\"dd/MM/yyyy\");\n\n        Date today = new Date();\n        String dateToStr = format.format(today);\n\n        today_date = db_date_format.format(today);\n        qr_today_date = qr_date_format.format(today);\n\n        tv_date.setText(dateToStr);\n        tv_time.setText(route_departure_time.substring(0, 5));\n        tv_route.setText(route_name);\n\n        if(action.equals(\"boarding\")) {\n            tv_action_performed.setText(getResources().getString(R.string.now_boarding));\n            getDailyTickets(route_id, route_departure_time);\n        }else{\n            tv_action_performed.setText(getResources().getString(R.string.now_verifing));\n        }\n\n        mOperatorDisplay.setText(mSharedPreferences.getString(Config.OPERATOR_NAME_SHARED_PREF, getString(R.string.prompt_empty_values)));\n        mOperatorDisplayLabel.setText(\"SCANNED: \" + Integer.toString(mScannedTickets));\n        //System.out.println(\"SELECTED TIME: \" + mSharedPreferences.getString(Config.SHARED_DEPARTURE_DATE, \"NA\"));\n\n        mVerifyTicketButton.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                System.out.println(\"MODEL \" + Build.MODEL);\n                if(Build.MODEL.equals(\"EDA50K\") || Build.MODEL.equals(\"EDA51K\")){\n                    mVerifyTicketButton.setVisibility(View.GONE);\n                }\n                new GetTicketNumberTask().execute();\n            }\n        });\n\n        mSearchTicketButton.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                showManualDialog();\n            }\n        });\n\n        mLogoutButton.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View view) {\n                logout();\n            }\n        });\n\n        // get bar code instance from MainActivity\n        barcodeReader = RouteActivity.getBarcodeObject();\n\n        if (barcodeReader != null) {\n            System.out.println(\"BARCODE AVAILABLE HERE\");\n            // register bar code event listener\n            barcodeReader.addBarcodeListener(this);\n            // set the trigger mode to client control\n            try {\n                barcodeReader.setProperty(BarcodeReader.PROPERTY_TRIGGER_CONTROL_MODE,\n                        BarcodeReader.TRIGGER_CONTROL_MODE_AUTO_CONTROL);\n                barcodeReader.setProperty(BarcodeReader.PROPERTY_NOTIFICATION_GOOD_READ_ENABLED, false);\n            } catch (UnsupportedPropertyException e) {\n                Toast.makeText(this, \"Failed to apply properties\", Toast.LENGTH_SHORT).show();\n            }\n            // register trigger state change listener\n            barcodeReader.addTriggerListener(this);\n            Map<String, Object> properties = new HashMap<String, Object>();\n            // Set Symbologies On/Off\n            properties.put(BarcodeReader.PROPERTY_CODE_128_ENABLED, true);\n            properties.put(BarcodeReader.PROPERTY_GS1_128_ENABLED, true);\n            properties.put(BarcodeReader.PROPERTY_QR_CODE_ENABLED, true);\n            properties.put(BarcodeReader.PROPERTY_CODE_39_ENABLED, true);\n            properties.put(BarcodeReader.PROPERTY_DATAMATRIX_ENABLED, true);\n            properties.put(BarcodeReader.PROPERTY_UPC_A_ENABLE, true);\n            properties.put(BarcodeReader.PROPERTY_EAN_13_ENABLED, false);\n            properties.put(BarcodeReader.PROPERTY_AZTEC_ENABLED, false);\n            properties.put(BarcodeReader.PROPERTY_CODABAR_ENABLED, false);\n            properties.put(BarcodeReader.PROPERTY_INTERLEAVED_25_ENABLED, false);\n            properties.put(BarcodeReader.PROPERTY_PDF_417_ENABLED, false);\n            // Set Max Code 39 barcode length\n            properties.put(BarcodeReader.PROPERTY_CODE_39_MAXIMUM_LENGTH, 10);\n            // Turn on center decoding\n            properties.put(BarcodeReader.PROPERTY_CENTER_DECODE, true);\n            // Enable bad read response\n            properties.put(BarcodeReader.PROPERTY_NOTIFICATION_BAD_READ_ENABLED, true);\n            // Apply the settings\n            barcodeReader.setProperties(properties);\n        }else{\n            if(Build.MODEL.equals(\"EDA50K\") || Build.MODEL.equals(\"EDA51K\")) {\n                Intent intent = new Intent(MainActivity.this, RouteActivity.class);\n                startActivity(intent);\n                finish();\n            }else{\n                mVerifyTicketButton.setVisibility(View.VISIBLE);\n            }\n        }\n    }\n\n    private void playSound(int resId) {\n        MediaPlayer mediaPlayer = MediaPlayer.create(this, resId);\n        mediaPlayer.setOnCompletionListener(mp -> {\n            mp.reset();\n            mp.release();\n        });\n        mediaPlayer.start();\n    }\n\n    @Override\n    public void onBarcodeEvent(final BarcodeReadEvent event) {\n        runOnUiThread(new Runnable() {\n            @Override\n            public void run() {\n                System.out.println(\"Sound starts here\");\n                mTicketNumberDisplay.setText(\"Result\");\n                if(event.getCodeId().toLowerCase().equals(\"j\")) {\n                    searchTicket(event.getBarcodeData());\n                }else if (event.getCodeId().toLowerCase().equals(\"s\")){\n                   extractTicketNumberFromQRCode(event.getBarcodeData());\n                    System.out.println(qr_departure_date + \" - \" + qr_today_date);\n                    if(qr_ticket_number == null){\n                        Config.doVibration(MainActivity.this);\n                        playSound(R.raw.not_available_beep);\n                        mPassengerNameDisplay.setText(\"Invalid Ticket\");\n                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                        mPassengerNameDisplay.setTextColor(Color.parseColor(\"#A93226\"));\n                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                        mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                        mVerifyTicketButton.setEnabled(true);\n                        return;\n                    }else if(!qr_ticket_number.substring(0, 3).equals(\"ZFF\") && !qr_ticket_number.substring(0, 3).equals(\"ZFA\")){\n                        Config.doVibration(MainActivity.this);\n                        playSound(R.raw.failure_beep);\n                        mPassengerNameDisplay.setTextColor(Color.RED);\n                        mPassengerNameDisplay.setText(R.string.company_invalid);\n                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.ic_no_entry, 0, 0);\n                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                        mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                        mVerifyTicketButton.setEnabled(true);\n                    }else if(!qr_departure_date.equals(qr_today_date)){\n                        Config.doVibration(MainActivity.this);\n                        playSound(R.raw.failure_beep);\n                        mPassengerNameDisplay.setTextColor(Color.RED);\n                        mPassengerNameDisplay.setText(R.string.date_invalid);\n                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));                            mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                        mVerifyTicketButton.setEnabled(true);\n                        mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                    }else if(!qr_departure_time.substring(0, 8).equals(route_departure_time.substring(0, 8))){\n                        System.out.println(qr_departure_time);\n                        System.out.println(route_departure_time);\n                        Config.doVibration(MainActivity.this);\n                        playSound(R.raw.failure_beep);\n                        mPassengerNameDisplay.setTextColor(Color.RED);\n                        mPassengerNameDisplay.setText(R.string.time_invalid);\n                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                        mVerifyTicketButton.setEnabled(true);\n                        mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                   }else if(!qr_route.equals(route_name)){\n                        Config.doVibration(MainActivity.this);\n                        playSound(R.raw.failure_beep);\n                        mPassengerNameDisplay.setTextColor(Color.RED);\n                        mPassengerNameDisplay.setText(R.string.ticket_not_for_this_route);\n                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                        mVerifyTicketButton.setEnabled(true);\n                        mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                   } else{\n                       searchTicket(qr_ticket_number);\n                   }\n                }\n            }\n        });\n    }\n\n    private void extractTicketNumberFromQRCode(String qrdata){\n        System.out.println(\"TICKET EXTRACTION: \" + qrdata);\n        if(!qrdata.startsWith(\"{\")){\n            qr_ticket_number = null;\n        } else {\n            try {\n                JSONObject jsonObject = new JSONObject(qrdata);\n                JSONObject ticket = jsonObject.getJSONObject(\"Ticket\");\n                System.out.println(\"Ticket Data here: \" + ticket);\n                qr_ticket_number = ticket.get(\"Ticket Number\").toString();\n                qr_departure_date =  ticket.get(\"Departure Date\").toString();\n                qr_departure_time =  ticket.get(\"Departure Time\").toString();\n                qr_destination =  ticket.get(\"Destination\").toString();\n                qr_name =  ticket.get(\"Passenger Name\").toString();\n                qr_age =  ticket.get(\"Age\").toString();\n                qr_route =  ticket.get(\"Boarding Point\").toString() +\" - \" + ticket.get(\"Destination\").toString();\n            }catch (JSONException e) {\n                Config.doVibration(MainActivity.this);\n                System.out.println(\"Barcode Error: \" + e);\n                Log.e(\"QR_PARSE_ERROR\", \"Invalid QR Code data\", e);\n            }\n        }\n    }\n\n    // When using Automatic Trigger control do not need to implement the\n    // onTriggerEvent function\n    @Override\n    public void onTriggerEvent( TriggerStateChangeEvent event) {\n        // TODO Auto-generated method stub\n    }\n\n    @Override\n    public void onFailureEvent( BarcodeFailureEvent arg0) {\n        // TODO Auto-generated method stub\n    }\n\n    @Override\n    public void onResume() {\n        super.onResume();\n        if (barcodeReader != null) {\n            try {\n                barcodeReader.claim();\n            } catch (ScannerUnavailableException e) {\n                e.printStackTrace();\n                Toast.makeText(this, \"Scanner unavailable\", Toast.LENGTH_SHORT).show();\n            }\n        }\n    }\n\n    @Override\n    public void onPause() {\n        super.onPause();\n        if (barcodeReader != null) {\n            // release the scanner claim so we don't get any scanner\n            // notifications while paused.\n            barcodeReader.release();\n        }\n    }\n\n    @Override\n    public void onDestroy() {\n        super.onDestroy();\n        if (barcodeReader != null) {\n            // unregister barcode event listener\n            barcodeReader.removeBarcodeListener(this);\n            // unregister trigger state change listener\n            barcodeReader.removeTriggerListener(this);\n        }\n    }\n\n    //Logout function\n    public void logout(){\n        //Creating an alert dialog to confirm logout\n        AlertDialog.Builder alertDialogBuilder = new AlertDialog.Builder(this);\n        alertDialogBuilder.setMessage(R.string.logout_confirmation);\n        alertDialogBuilder.setPositiveButton(R.string.yes,\n                new DialogInterface.OnClickListener() {\n                    @Override\n                    public void onClick(DialogInterface arg0, int arg1) {\n                        signout();\n                    }\n                });\n\n        alertDialogBuilder.setNegativeButton(R.string.no,\n                new DialogInterface.OnClickListener() {\n                    @Override\n                    public void onClick(DialogInterface arg0, int arg1) {\n\n                    }\n                });\n        //Showing the alert dialog\n        AlertDialog alertDialog = alertDialogBuilder.create();\n        alertDialog.show();\n    }\n\n    private void showManualDialog(){\n        manualDialog = new Dialog(this);\n        Button btnSearch;\n        //final EditText etUnit_no;\n        manualDialog.requestWindowFeature(Window.FEATURE_NO_TITLE);\n        manualDialog.setContentView(R.layout.dialog_add_manual);\n        mTicketNumberEditor = manualDialog.findViewById(R.id.et_ticket_number);\n        mTicketNumberEditor.setHint(\"Enter Ticket Number\");\n        manualDialog.setCancelable(false);\n        manualDialog.setCanceledOnTouchOutside(true);\n        manualDialog.show();\n\n        btnSearch = manualDialog.findViewById(R.id.btn_search);\n\n        btnSearch.setOnClickListener(new View.OnClickListener() {\n            @Override\n            public void onClick(View v) {\n                manualDialog.dismiss();\n                mTicketNumber = mTicketNumberEditor.getText().toString();\n                if (!mTicketNumber.startsWith(\"ZFF\") && !mTicketNumber.startsWith(\"ZFA\")) {\n                    // If it doesn't start with \"ZFF\" or \"ZFA\", prepend \"ZFF\"\n                    mTicketNumber = \"ZFF\" + mTicketNumber;\n                }\n\n                mTicketNumberDisplay.setText(getString(R.string.barcode_title_text).replace(getString(R.string.barcode_placeholder), mTicketNumber));\n                if (mTicketNumber != null && mTicketNumber.length() > 0) {\n                    JSONObject ticket = mDatabaseAdapter.getTicket(mTicketNumber);\n                    if (ticket.has(Config.TICKET_ID)) {\n                        try {\n                            // Check if the ticket is already scanned\n                            int isScanned = ticket.getInt(Config.TICKET_SCANNED);\n                            if (isScanned > 0) {\n                                mPassengerNameDisplay.setText(R.string.ticket_already_scanned);\n                                mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                                mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                mVerifyTicketButton.setEnabled(true);\n                                return;\n                            } else if (ticket.getString(Config.TICKET_STATUS).toLowerCase().equals(\"cancelled\")) {\n                                mPassengerNameDisplay.setText(R.string.ticket_cancelled);\n                                mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                                mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                mVerifyTicketButton.setEnabled(true);\n                                return;\n                            }\n                        } catch (JSONException ex) {\n                            mPassengerNameDisplay.setText(ex.getMessage());\n                            mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                            mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                            mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                            mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                            mVerifyTicketButton.setEnabled(true);\n                            return;\n                        }\n                        processOnlineTicket();\n//                        processTicket(ticket);\n                    } else {\n                        processOnlineTicket();\n                        return;\n                    }\n                } else {\n\n                    mPassengerNameDisplay.setText(R.string.passenger_not_found);\n                    mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                    mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                    mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                }\n\n                mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                mVerifyTicketButton.setEnabled(true);\n            }\n        });\n    }\n\n    private void signout(){\n        final ProgressDialog loading;\n        loading = ProgressDialog.show(mContext, \"Logout...\", \"Please wait...\", false, false);\n        StringRequest stringRequest = new StringRequest(Request.Method.POST, Config.LOGOUT_URL,\n                new Response.Listener<String>() {\n                    @Override\n                    public void onResponse(String response) {\n                        System.out.println(\"Logout response\" +response);\n                        loading.dismiss();\n                        try {\n                            JSONObject jsonObject = new JSONObject(response);\n                            JSONArray operatorResult = jsonObject.getJSONArray(\"operator\");\n                            JSONObject operatorData = operatorResult.getJSONObject(0);\n                            result_status = operatorData.getString(Config.KEY_STATUS);\n\n                        } catch (JSONException e) {\n                            e.printStackTrace();\n                            System.out.println(\"MESSAGE ERROR \" + e.getMessage());\n                        }\n\n                        if(result_status.equalsIgnoreCase(Config.LOGOUT_SUCCESS)){\n\n                        }else{\n                            //If the server response is not success\n                            //Displaying an error message on toast\n//                            Toast.makeText(mContext, result_status, Toast.LENGTH_LONG).show();\n                        }\n                        //Getting out sharedpreferences\n                        SharedPreferences preferences = getSharedPreferences(Config.SHARED_PREF_NAME, Context.MODE_PRIVATE);\n                        //Getting editor\n                        SharedPreferences.Editor editor = preferences.edit();\n                        //Puting the value false for loggedin\n                        editor.putBoolean(Config.LOGGEDIN_SHARED_PREF, false);\n                        //Putting blank value to email\n                        editor.putString(Config.OPERATOR_SHARED_PREF, \"\");\n                        editor.putString(Config.OPERATOR_NAME_SHARED_PREF, \"\");\n                        editor.putInt(Config.SHARED_TOTAL_TICKETS, 0);\n                        editor.putInt(Config.SHARED_SCANNED_TICKETS, 0);\n                        //Saving the sharedpreferences\n                        editor.commit();\n                        mDatabaseAdapter.clearDatabase();\n                        //Starting login activity\n                        Intent intent = new Intent(MainActivity.this, LoginActivity.class);\n                        intent.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_CLEAR_TASK | Intent.FLAG_ACTIVITY_NEW_TASK );\n                        startActivity(intent);\n                        finish();\n                    }\n                },\n                new Response.ErrorListener() {\n                    @Override\n                    public void onErrorResponse(VolleyError error) {\n                        System.out.println(\"ERROR SIGNOUT: \" + error.getMessage());\n                        //You can handle error here if you want\n                        loading.dismiss();\n                        Toast.makeText(mContext, error.toString(), Toast.LENGTH_LONG).show();\n                    }\n                }){\n            @Override\n            protected Map<String, String> getParams() throws AuthFailureError {\n\n                Map<String,String> params = new HashMap<>();\n                //Adding parameters to request\n                params.put(\"operator_no\", operator);\n                params.put(Config.API_KEY_NAME, Config.API_KEY);\n\n                //returning parameter\n                return params;\n            }\n            @Override\n            public Map<String, String> getHeaders() throws AuthFailureError {\n                Map<String,String> headers = new HashMap<>();\n                // add headers <key,value>\n                String credentials = Config.API_USER_NAME + \":\" + Config.API_PASSWORD;\n                String auth = \"Basic \" + Base64.encodeToString(credentials.getBytes(), Base64.NO_WRAP);\n                //System.out.println(\"CREDENTIALS: \" + auth + \"\\n\");\n                headers.put(\"Authorization\", auth);\n                return headers;\n            }\n        };\n\n        //Adding the string request to the queue\n        RequestQueue requestQueue = Volley.newRequestQueue(this);\n        stringRequest.setRetryPolicy(new DefaultRetryPolicy(\n                40000,\n                DefaultRetryPolicy.DEFAULT_MAX_RETRIES,\n                DefaultRetryPolicy.DEFAULT_BACKOFF_MULT)\n        );\n        requestQueue.add(stringRequest);\n    }\n\n    private void processTicket(JSONObject ticket) {\n        System.out.println(\"Process Ticket\");\n        try {\n                Config.doVibration(MainActivity.this);\n                playSound(R.raw.success_beep);\n                mPassengerNameDisplay.setTextColor(Color.parseColor(\"#358f80\"));\n                mPassengerNameDisplay.setText(qr_name);\n                mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.ic_check, 0, 0);\n                mTicketNumberDisplay.setTextColor(Color.rgb(24, 106, 59));\n                mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_success_display_border));\n                mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#186A3B\"));\n            mScannedTickets += 1;\n            mOperatorDisplayLabel.setText(\"SCANNED: \" + Integer.toString(mScannedTickets));\n            mDatabaseAdapter.update(ticket.getString(Config.TICKET_ID), ticket.getInt(Config.TICKET_SCAN_COUNT) + 1);\n\n            //markTicketBoarded();\n            System.out.println(\"Action: \" +  action);\n            if(action.equals(\"boarding\")) {\n                System.out.println(\"Boarding Ticket...\");\n                processOnlineTicket();\n            }else{\n                System.out.println(\"Verify Ticket...\");\n                verifyTicket();\n            }\n        } catch (JSONException ex) {\n            if(action.equals(\"boarding\")) {\n                processOnlineTicket(\n\n                );\n            }else{\n                verifyTicket();\n            }\n        }\n    }\n\n    private void processOnlineTicket() {\n        final ProgressDialog loading;\n        loading = ProgressDialog.show(mContext, \"Checking...\", \"Please wait...\", false, false);\n        StringRequest stringRequest = new StringRequest(Request.Method.POST, Config.FIND_TICKET_URL,\n                new Response.Listener<String>(){\n                    @Override\n                    public void onResponse(String response) {\n                        loading.dismiss();\n                        System.out.println(\"Search Ticket RESPONSE: \" + response);\n                        try {\n                            JSONObject responseData = new JSONObject(response);\n                            try {\n                                if (responseData.has(Config.RESPONSE_CODE)) {\n                                    if(!mTicketNumber.substring(0, 3).equals(\"ZFF\") && !mTicketNumber.substring(0, 3).equals(\"ZFA\")){\n                                        Config.doVibration(MainActivity.this);\n                                        playSound(R.raw.failure_beep);\n                                        mPassengerNameDisplay.setTextColor(Color.RED);\n                                        mPassengerNameDisplay.setText(R.string.company_invalid);\n                                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.ic_no_entry, 0, 0);\n                                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                        mVerifyTicketButton.setEnabled(true);\n                                        mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                                    }else if (responseData.getInt(Config.RESPONSE_CODE) == 100){\n                                        System.out.println(\"TUPO HUMU \uD83E\uDD1D\");\n                                        Config.doVibration(MainActivity.this);\n                                        playSound(R.raw.failure_beep);\n                                        mPassengerNameDisplay.setTextColor(Color.parseColor(\"#A93226\"));\n                                        mPassengerNameDisplay.setText(R.string.ticket_already_scanned);\n                                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                        mVerifyTicketButton.setEnabled(true);\n                                        mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                                        return;\n                                    } else  if (responseData.getInt(Config.RESPONSE_CODE) == 400){\n                                        Config.doVibration(MainActivity.this);\n                                        playSound(R.raw.failure_beep);\n                                        mPassengerNameDisplay.setTextColor(Color.RED);\n                                        mPassengerNameDisplay.setText(R.string.ticket_cancelled);\n                                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_success_display_border));\n                                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                        mVerifyTicketButton.setEnabled(true);\n                                        mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                                        return;\n                                    } else  if (responseData.getInt(Config.RESPONSE_CODE) == 700){\n                                        Config.doVibration(MainActivity.this);\n                                        playSound(R.raw.failure_beep);\n                                        mPassengerNameDisplay.setTextColor(Color.RED);\n                                        mPassengerNameDisplay.setText(R.string.ticket_notfound);\n                                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_success_display_border));\n                                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                        mVerifyTicketButton.setEnabled(true);\n                                        mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                                        return;\n                                    } else  if (responseData.getInt(Config.RESPONSE_CODE) == 800){\n                                        Config.doVibration(MainActivity.this);\n                                        playSound(R.raw.failure_beep);\n                                        mPassengerNameDisplay.setTextColor(Color.RED);\n                                        mPassengerNameDisplay.setText(R.string.ticket_notfound);\n                                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                        mVerifyTicketButton.setEnabled(true);\n                                        mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                                        return;\n                                    }else  if (responseData.getInt(Config.RESPONSE_CODE) == 655){\n                                        Config.doVibration(MainActivity.this);\n                                        playSound(R.raw.failure_beep);\n                                        mPassengerNameDisplay.setTextColor(Color.RED);\n                                        mPassengerNameDisplay.setText(R.string.ticket_not_for_this_route);\n                                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_success_display_border));\n                                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                        mVerifyTicketButton.setEnabled(true);\n                                        mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                                        return;\n                                    }\n                                    else  if (responseData.getInt(Config.RESPONSE_CODE) == 200){\n                                        mScannedTickets += 1;                                        Config.doVibration(MainActivity.this);\n                                        playSound(R.raw.success_beep);\n                                        if(Objects.equals(qr_name, null)){\n                                            mPassengerNameDisplay.setText(R.string.ticket_valid);\n                                        }else{\n                                            mPassengerNameDisplay.setText(qr_name);\n                                        }\n                                        if(!qr_age.equals(\"Adult\")){\n                                            mPassengerNameDisplay.setTextColor(Color.parseColor(\"#9c6644\"));\n                                            mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.ic_child_check, 0, 0);\n                                            mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                            mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.child_border));\n                                            mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#9c6644\"));\n                                        }else{\n                                            mPassengerNameDisplay.setTextColor(Color.parseColor(\"#186A3B\"));\n                                            mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_tick_box_48, 0, 0);\n                                            mTicketNumberDisplay.setTextColor(Color.rgb(24, 106, 59));\n                                            mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_success_display_border));\n                                            mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#186A3B\"));\n                                        }\n                                        //mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                        //mVerifyTicketButton.setEnabled(true);\n                                        return;\n                                    }\n                                    else  if (responseData.getInt(Config.RESPONSE_CODE) == 600) {\n                                        Config.doVibration(MainActivity.this);\n                                        playSound(R.raw.failure_beep);\n                                        mPassengerNameDisplay.setTextColor(Color.RED);\n                                        mPassengerNameDisplay.setText(R.string.date_invalid);\n                                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_success_display_border));\n                                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                        mVerifyTicketButton.setEnabled(true);\n                                        mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                                    }else  if (responseData.getInt(Config.RESPONSE_CODE) == 650){\n                                        Config.doVibration(MainActivity.this);\n                                        playSound(R.raw.failure_beep);\n                                        mPassengerNameDisplay.setTextColor(Color.RED);\n                                        mPassengerNameDisplay.setText(R.string.time_invalid);\n                                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_success_display_border));\n                                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                        mVerifyTicketButton.setEnabled(true);\n                                        mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                                    }\n                                    /*else if (!route_id.equals(route)){\n                                        Config.doVibration(MainActivity.this);\n                                        mPassengerNameDisplay.setTextColor(Color.RED);\n                                        mPassengerNameDisplay.setText(R.string.route_invalid);\n                                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_success_display_border));\n                                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                        mVerifyTicketButton.setEnabled(true);\n                                        return;\n                                    }else if (!depart_time.equals(route_departure_time)) {\n                                        Config.doVibration(MainActivity.this);\n                                        mPassengerNameDisplay.setTextColor(Color.RED);\n                                        mPassengerNameDisplay.setText(R.string.time_invalid);\n                                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_success_display_border));\n                                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                        mVerifyTicketButton.setEnabled(true);\n                                        return;\n                                    } **/\n                                }\n                                //mPassengerNameDisplay.setText(responseData.getString(Config.PASSENGER_NAME));\n                                //mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_tick_box_48, 0, 0);\n                                //mTicketNumberDisplay.setTextColor(Color.rgb(24, 106, 59));\n                                //mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_success_display_border));\n                                mScannedTickets += 1;\n                                mOperatorDisplayLabel.setText(\"SCANNED: \" + Integer.toString(mScannedTickets));\n\n                                //markTicketBoarded();\n                            } catch (JSONException ex) {\n                                System.out.println(\"JSON ERROR: \" + ex);\n                                mPassengerNameDisplay.setText(R.string.passenger_not_found);\n                                mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                            }\n\n                        } catch (JSONException e) {\n                            System.out.println(\"TICKET ERRORS: \" + e.getMessage());\n                            e.printStackTrace();\n                            mPassengerNameDisplay.setText(R.string.passenger_not_found);\n                            mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                            mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                            mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                        }\n                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                        mVerifyTicketButton.setEnabled(true);\n                    }\n                },\n                new Response.ErrorListener() {\n                    @Override\n                    public void onErrorResponse(VolleyError error) {\n                        //You can handle error here if you want\n                        loading.dismiss();\n                        System.out.println(\"VOLLEY: \" + error.toString());\n                        mPassengerNameDisplay.setText(R.string.no_tickets_found);\n                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_info_48, 0, 0);\n                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_empty_display_border));\n                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                        mVerifyTicketButton.setEnabled(true);\n                    }\n                }){\n            @Override\n            protected Map<String, String> getParams() throws AuthFailureError {\n\n                Map<String,String> params = new HashMap<>();\n                //Adding parameters to request\n                params.put(\"reference\", mTicketNumber);\n                params.put(\"time\", route_departure_time);\n                params.put(\"date\", today_date);\n                params.put(\"operator\", operator);\n                params.put(\"pin\", pin);\n                params.put(\"route\", route_id);\n\n                System.out.println(\"SEARCH REQUEST: \" + params);\n                //returning parameter\n                return params;\n            }\n            @Override\n            public Map<String, String> getHeaders() throws AuthFailureError {\n                Map<String,String> headers = new HashMap<>();\n                // add headers <key,value>\n                String credentials = Config.API_USER_NAME + \":\" + Config.API_PASSWORD;\n                String auth = \"Basic \" + Base64.encodeToString(credentials.getBytes(), Base64.NO_WRAP);\n                System.out.println(\"CREDENTIALS: \" + auth + \"\\n\");\n                headers.put(\"Authorization\", auth);\n                return headers;\n            }\n        };\n\n        //Adding the string request to the queue\n        RequestQueue requestQueue = Volley.newRequestQueue(this);\n        stringRequest.setRetryPolicy(new DefaultRetryPolicy(\n                40000,\n                DefaultRetryPolicy.DEFAULT_MAX_RETRIES,\n                DefaultRetryPolicy.DEFAULT_BACKOFF_MULT)\n        );\n        requestQueue.add(stringRequest);\n    }\n\n    private void verifyTicket() {\n\n        final ProgressDialog loading;\n        loading = ProgressDialog.show(mContext, \"Verifying...\", \"Please wait...\", false, false);\n        StringRequest stringRequest = new StringRequest(Request.Method.POST, Config.VERIFY_TICKET_URL,\n                response -> {\n                    System.out.println(\"Verify Ticket RESPONSE: \" + response);\n                    loading.dismiss();\n                    try {\n                        JSONObject responseData = new JSONObject(response);\n                        try {\n                            if (responseData.has(Config.RESPONSE_CODE)) {\n                                if (responseData.getInt(Config.RESPONSE_CODE) == 100){\n                                    Config.doVibration(MainActivity.this);\n                                    playSound(R.raw.failure_beep);\n                                    mPassengerNameDisplay.setTextColor(Color.RED);\n                                    mPassengerNameDisplay.setText(R.string.ticket_already_scanned);\n                                    mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                    mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                    mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                                    mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                    mVerifyTicketButton.setEnabled(true);\n                                    mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                                    return;\n                                } else  if (responseData.getInt(Config.RESPONSE_CODE) == 400){\n                                    Config.doVibration(MainActivity.this);\n                                    playSound(R.raw.failure_beep);\n                                    mPassengerNameDisplay.setTextColor(Color.RED);\n                                    mPassengerNameDisplay.setText(R.string.ticket_cancelled);\n                                    mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                    mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                    mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                                    mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                    mVerifyTicketButton.setEnabled(true);\n                                    mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                                    return;\n                                }else  if (responseData.getInt(Config.RESPONSE_CODE) == 500){\n                                    Config.doVibration(MainActivity.this);\n                                    playSound(R.raw.failure_beep);\n                                    mPassengerNameDisplay.setTextColor(Color.RED);\n                                    mPassengerNameDisplay.setText(R.string.ticket_expired);\n                                    mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                    mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                    mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                                    mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                    mVerifyTicketButton.setEnabled(true);\n                                    mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                                    return;\n                                }else  if (responseData.getInt(Config.RESPONSE_CODE) == 300){\n                                    Config.doVibration(MainActivity.this);\n                                    playSound(R.raw.failure_beep);\n                                    mPassengerNameDisplay.setTextColor(Color.RED);\n                                    mPassengerNameDisplay.setText(R.string.ticket_expired);\n                                    mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                    mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                    mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                                    mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                    mVerifyTicketButton.setEnabled(true);\n                                    mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                                    return;\n                                }else  if (responseData.getInt(Config.RESPONSE_CODE) == 655){\n                                    Config.doVibration(MainActivity.this);\n                                    playSound(R.raw.failure_beep);\n                                    mPassengerNameDisplay.setTextColor(Color.RED);\n                                    mPassengerNameDisplay.setText(R.string.ticket_not_for_this_route);\n                                    mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                    mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                    mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                                    mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                    mVerifyTicketButton.setEnabled(true);\n                                    mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                                    return;\n                                } else  if (responseData.getInt(Config.RESPONSE_CODE) == 350){\n                                    Config.doVibration(MainActivity.this);\n                                    playSound(R.raw.failure_beep);\n                                    mPassengerNameDisplay.setTextColor(Color.RED);\n                                    mPassengerNameDisplay.setText(R.string.ticket_pending);\n                                    mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                    mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                    mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                                    mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                    mVerifyTicketButton.setEnabled(true);\n                                    mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                                    return;\n                                } else  if (responseData.getInt(Config.RESPONSE_CODE) == 700){\n                                    Config.doVibration(MainActivity.this);\n                                    mPassengerNameDisplay.setTextColor(Color.RED);\n                                    mPassengerNameDisplay.setText(R.string.ticket_notfound);\n                                    mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                    mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                    mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                                    mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                    mVerifyTicketButton.setEnabled(true);\n                                    return;\n                                }else  if (responseData.getInt(Config.RESPONSE_CODE) == 200){\n                                    Config.doVibration(MainActivity.this);\n                                    playSound(R.raw.success_beep);\n                                    if(Objects.equals(qr_name, null)){\n                                        mPassengerNameDisplay.setText(R.string.ticket_valid);\n                                    }else{\n                                        mPassengerNameDisplay.setText(qr_name);\n                                    }\n                                    if(!qr_age.equals(\"Adult\")){\n                                        mPassengerNameDisplay.setTextColor(Color.parseColor(\"#9c6644\"));\n                                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.ic_child_check, 0, 0);\n                                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.child_border));\n                                        mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#9c6644\"));\n                                    }else{\n                                        mPassengerNameDisplay.setTextColor(Color.parseColor(\"#186A3B\"));\n                                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_tick_box_48, 0, 0);\n                                        mTicketNumberDisplay.setTextColor(Color.rgb(24, 106, 59));\n                                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_success_display_border));\n                                        mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#186A3B\"));\n                                    }\n                                    //mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                    //mVerifyTicketButton.setEnabled(true);\n                                    return;\n                                } else  if (responseData.getInt(Config.RESPONSE_CODE) == 600) {\n                                    Config.doVibration(MainActivity.this);\n                                    playSound(R.raw.failure_beep);\n                                    mPassengerNameDisplay.setTextColor(Color.RED);\n                                    mPassengerNameDisplay.setText(R.string.date_invalid);\n                                    mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                    mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                    mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                                    mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                    mVerifyTicketButton.setEnabled(true);\n                                    mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                                }else  if (responseData.getInt(Config.RESPONSE_CODE) == 650){\n                                    Config.doVibration(MainActivity.this);\n                                    playSound(R.raw.failure_beep);\n                                    mPassengerNameDisplay.setTextColor(Color.RED);\n                                    mPassengerNameDisplay.setText(R.string.time_invalid);\n                                    mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                    mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                    mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                                    mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                    mVerifyTicketButton.setEnabled(true);\n                                    mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                                } else if(!qr_ticket_number.substring(0, 3).equals(\"ZFF\") && !qr_ticket_number.substring(0, 3).equals(\"ZAF\")) {//changed from ZFA to ZAF\n                                    Config.doVibration(MainActivity.this);\n                                    playSound(R.raw.failure_beep);\n                                    mPassengerNameDisplay.setTextColor(Color.RED);\n                                    mPassengerNameDisplay.setText(R.string.company_invalid);\n                                    mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.ic_no_entry, 0, 0);\n                                    mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                    mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                                    mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                                    mVerifyTicketButton.setEnabled(true);\n                                    mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                                }\n\n                            }\n                            mScannedTickets += 1;\n                            mOperatorDisplayLabel.setText(\"SCANNED: \" + Integer.toString(mScannedTickets));\n                        } catch (JSONException ex) {\n\n                            System.out.println(\"JSON ERROR: \" + ex);\n                            mPassengerNameDisplay.setText(R.string.passenger_not_found);\n                            mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                            mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                            mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                        }\n                    } catch (JSONException e) {\n                        System.out.println(\"TICKET ERRORS: \" + e.getMessage());\n                        e.printStackTrace();\n                        mPassengerNameDisplay.setText(R.string.passenger_not_found);\n                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                    }\n                    mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                    mVerifyTicketButton.setEnabled(true);\n                },\n                new Response.ErrorListener() {\n                    @Override\n                    public void onErrorResponse(VolleyError error) {\n                        loading.dismiss();\n                        //You can handle error here if you want\n                        System.out.println(\"VOLLEY: \" + error.toString());\n                        mPassengerNameDisplay.setText(R.string.no_tickets_found);\n                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_info_48, 0, 0);\n                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_empty_display_border));\n                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                        mVerifyTicketButton.setEnabled(true);\n                    }\n                }){\n            @Override\n            protected Map<String, String> getParams() throws AuthFailureError {\n\n                Map<String,String> params = new HashMap<>();\n                //Adding parameters to request\n                params.put(\"reference\", mTicketNumber);\n                params.put(\"time\", route_departure_time);\n                params.put(\"date\", today_date);\n                params.put(\"operator\", operator);\n                params.put(\"pin\", pin);\n                params.put(\"route\", route_id);\n\n                System.out.println(\"VERIFY REQUEST PARAMS: \" + params);\n                //returning parameter\n                return params;\n            }\n            @Override\n            public Map<String, String> getHeaders() throws AuthFailureError {\n                Map<String,String> headers = new HashMap<>();\n                // add headers <key,value>\n                String credentials = Config.API_USER_NAME + \":\" + Config.API_PASSWORD;\n                String auth = \"Basic \" + Base64.encodeToString(credentials.getBytes(), Base64.NO_WRAP);\n                System.out.println(\"CREDENTIALS: \" + auth + \"\\n\");\n                headers.put(\"Authorization\", auth);\n                return headers;\n            }\n        };\n\n        //Adding the string request to the queue\n        RequestQueue requestQueue = Volley.newRequestQueue(this);\n        stringRequest.setRetryPolicy(new DefaultRetryPolicy(\n                40000,\n                DefaultRetryPolicy.DEFAULT_MAX_RETRIES,\n                DefaultRetryPolicy.DEFAULT_BACKOFF_MULT)\n        );\n        requestQueue.add(stringRequest);\n    }\n\n    private void markTicketBoarded() {\n        StringRequest stringRequest = new StringRequest(Request.Method.POST, Config.UPDATE_TICKET_URL,\n                new Response.Listener<String>(){\n                    @Override\n                    public void onResponse(String response) {\n\n                        try {\n                            JSONObject responseData = new JSONObject(response);\n                            System.out.println(responseData.toString());\n                            /*try {\n                                mPassengerNameDisplay.setText(responseData.getString(Config.PASSENGER_NAME));\n                                mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_tick_box_48, 0, 0);\n                                mTicketNumberDisplay.setTextColor(Color.rgb(24, 106, 59));\n                                mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_success_display_border));\n                                ToneGenerator toneGen1 = new ToneGenerator(AudioManager.STREAM_MUSIC, 100);\n                                toneGen1.startTone(ToneGenerator.TONE_CDMA_ABBR_ALERT,150);\n                            } catch (JSONException ex) {\n                                ToneGenerator toneGen1 = new ToneGenerator(AudioManager.STREAM_MUSIC, 100);\n                                toneGen1.startTone(ToneGenerator.TONE_CDMA_CALLDROP_LITE,150);\n                                mPassengerNameDisplay.setText(R.string.passenger_not_found);\n                                mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                                mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                                mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                            }*/\n\n                        } catch (JSONException e) {\n                            System.out.println(\"TICKET ERRORS MARK TICKET: \" + e.getMessage());\n                            e.printStackTrace();\n                        }\n                    }\n                },\n                new Response.ErrorListener() {\n                    @Override\n                    public void onErrorResponse(VolleyError error) {\n                        //You can handle error here if you wan\n                        System.out.println(error.toString());\n                    }\n                }){\n            @Override\n            protected Map<String, String> getParams() throws AuthFailureError {\n                String operator = mSharedPreferences.getString(Config.OPERATOR_SHARED_PREF, \"0\");\n                Map<String,String> params = new HashMap<>();\n                //Adding parameters to request\n                params.put(\"ticket_id\", mTicketNumber);\n                params.put(\"boarding_status\", \"YES\");\n                params.put(\"operator_id\", operator);\n                params.put(\"device_id\", getIMEI());\n                params.put(Config.API_KEY_NAME, Config.API_KEY);\n\n                //returning parameter\n                return params;\n            }\n            @Override\n            public Map<String, String> getHeaders() throws AuthFailureError {\n                Map<String,String> headers = new HashMap<>();\n                // add headers <key,value>\n                String credentials = Config.API_USER_NAME + \":\" + Config.API_PASSWORD;\n                String auth = \"Basic \" + Base64.encodeToString(credentials.getBytes(), Base64.NO_WRAP);\n                System.out.println(\"CREDENTIALS: \" + auth + \"\\n\");\n                headers.put(\"Authorization\", auth);\n                return headers;\n            }\n        };\n\n        //Adding the string request to the queue\n        RequestQueue requestQueue = Volley.newRequestQueue(this);\n        stringRequest.setRetryPolicy(new DefaultRetryPolicy(\n                40000,\n                DefaultRetryPolicy.DEFAULT_MAX_RETRIES,\n                DefaultRetryPolicy.DEFAULT_BACKOFF_MULT)\n        );\n        requestQueue.add(stringRequest);\n    }\n\n    private class GetTicketNumberTask extends AsyncTask<Void, Void, Exception> {\n        String message;\n\n\n        @Override\n        protected Exception doInBackground(Void... params) {\n            Exception result = null;\n            try{\n                Decode.open();\n                message = Decode.read(10000);\n            }catch (Exception e){\n                e.printStackTrace();\n                result = e;\n            }finally {\n                Decode.close();\n            }\n            return result;\n        }\n\n        @Override\n        protected void onPreExecute() {\n            super.onPreExecute();\n\n            mVerifyTicketButton.setText(R.string.operating);\n            mVerifyTicketButton.setEnabled(false);\n        }\n\n        @Override\n        protected void onPostExecute(Exception result) {\n            super.onPostExecute(result);\n\n            Config.doVibration(MainActivity.this);\n            ToneGenerator toneGen1 = new ToneGenerator(AudioManager.USE_DEFAULT_STREAM_TYPE, 50);\n            toneGen1.startTone(ToneGenerator.TONE_CDMA_EMERGENCY_RINGBACK,150);\n\n\n            if(result == null){\n                searchTicket(message);\n            }else {\n                Toast.makeText(MainActivity.this, getString(R.string.operation_fail), Toast.LENGTH_LONG).show();\n                Intent intent = new Intent(MainActivity.this, MainActivity.class);\n                startActivity(intent);\n            }\n        }\n    }\n\n    private void searchTicket(String message){\n        mTicketNumber = message;\n        mTicketNumberDisplay.setText(getString(R.string.barcode_title_text).replace(getString(R.string.barcode_placeholder), mTicketNumber));\n        if (mTicketNumber != null && mTicketNumber.length() > 0) {\n            JSONObject ticket = mDatabaseAdapter.getTicket(mTicketNumber);\n\n            if (ticket.has(Config.TICKET_ID)) {\n                try {\n                    // Check if the ticket is already scanned\n                    int isScanned = ticket.getInt(Config.TICKET_SCANNED);\n                    if(!mTicketNumber.substring(0, 3).equals(\"ZFF\") && !mTicketNumber.substring(0, 3).equals(\"ZFA\")){\n                        Config.doVibration(MainActivity.this);\n                        playSound(R.raw.failure_beep);\n                        mPassengerNameDisplay.setTextColor(Color.RED);\n                        mPassengerNameDisplay.setText(R.string.company_invalid);\n                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.ic_no_entry, 0, 0);\n                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                        mVerifyTicketButton.setEnabled(true);\n                        mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                    }else if (isScanned > 0) {\n                        Config.doVibration(MainActivity.this);\n                        playSound(R.raw.failure_beep);\n                        mPassengerNameDisplay.setText(R.string.ticket_already_scanned);\n                        mPassengerNameDisplay.setTextColor(Color.parseColor(\"#A93226\"));\n                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                        mTicketNumberDisplay.setTextColor(Color.parseColor(\"#A93226\"));\n                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                        mVerifyTicketButton.setEnabled(true);\n                        mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                        return;\n                    } else if (ticket.getString(Config.TICKET_STATUS).toLowerCase().equals(\"cancelled\")) {\n                        Config.doVibration(MainActivity.this);\n                        playSound(R.raw.failure_beep);\n                        mPassengerNameDisplay.setText(R.string.ticket_cancelled);\n                        mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                        mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                        mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                     //   toneGen1.startTone(ToneGenerator.TONE_CDMA_CALLDROP_LITE,150);\n                        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                        mVerifyTicketButton.setEnabled(true);\n                        mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                        return;\n                    }\n                } catch (JSONException ex) {\n                    Config.doVibration(MainActivity.this);\n                    playSound(R.raw.failure_beep);\n                    mPassengerNameDisplay.setText(ex.getMessage());\n                    mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n                    mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n                    mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n                    mVerifyTicketButton.setText(R.string.button_scan_sticker);\n                    mVerifyTicketButton.setEnabled(true);\n                    mSearchTicketButton.setBackgroundColor(Color.parseColor(\"#A93226\"));\n                    return;\n                }\n\n                if(action.equals(\"boarding\")) {\n                    System.out.println(\"Boarding Ticket...\");\n                    processOnlineTicket();\n                   // processTicket(ticket);\n                }else{\n                    System.out.println(\"Verify Ticket...\");\n                    verifyTicket();\n                }\n\n            } else {\n                if(action.equals(\"boarding\")) {\n                    System.out.println(\"Boarding Ticket...\");\n                    processOnlineTicket();\n                }else{\n                    System.out.println(\"Verify Ticket...\");\n                    verifyTicket();\n                }\n                return;\n            }\n        } else {\n            mPassengerNameDisplay.setText(R.string.passenger_not_found);\n            mPassengerNameDisplay.setCompoundDrawablesWithIntrinsicBounds(0, R.drawable.icons8_close_window_48, 0, 0);\n            mTicketNumberDisplay.setTextColor(Color.rgb(169, 50, 38));\n            mTicketNumberDisplay.setBackground(getResources().getDrawable(R.drawable.ticket_failure_display_border));\n        }\n\n        mVerifyTicketButton.setText(R.string.button_scan_sticker);\n        mVerifyTicketButton.setEnabled(true);\n    }\n\n    public String getIMEI(){\n        String IMEI = \"\";\n        if (ContextCompat.checkSelfPermission(this, Manifest.permission.READ_PHONE_STATE)\n                != PackageManager.PERMISSION_GRANTED) {\n            // We do not have this permission. Let's ask the user\n            //Activity.requestPermissions(this, new String[]{Manifest.permission.READ_PHONE_STATE}, 0);\n            IMEI = \"IMEI UNAVAILABLE\";\n        }else {\n            TelephonyManager tm = (TelephonyManager)getSystemService(Context.TELEPHONY_SERVICE);\n            IMEI = tm.getDeviceId();\n\n        }\n        return IMEI;\n    }\n\n\n    //option menu at the top\n    @Override\n    public boolean onCreateOptionsMenu( Menu menu) {\n        //Adding our menu_main to toolbar\n        MenuInflater inflater = getMenuInflater();\n        inflater.inflate(R.menu.menu_main, menu);\n        return true;\n    }\n\n    @Override\n    public boolean onOptionsItemSelected( MenuItem item) {\n        int id = item.getItemId();\n        if (id == R.id.menuLogout) {\n            //calling logout method when the logout button is clicked\n            logout();\n        }else if (id == R.id.menuChangeLocation) {\n                Intent intent = new Intent(MainActivity.this, RouteActivity.class);\n                intent.putExtra(\"action\",action);\n                startActivity(intent);\n                finish();\n        }else if (id == R.id.menuChangeMode) {\n            Intent intent = new Intent(MainActivity.this, ModeActivity.class);\n            startActivity(intent);\n            finish();\n        }\n        return super.onOptionsItemSelected(item);\n    }\n\n    private void getDailyTickets(final String route_id, final String route_departure_time) {\n        Date date = new Date();\n        String strDateFormat = \"yyyy-MM-dd\";\n        DateFormat dateFormat = new SimpleDateFormat(strDateFormat);\n        final String formattedDate = dateFormat.format(date);\n        mDepartureDate = formattedDate;\n        StringRequest stringRequest = new StringRequest(Request.Method.POST, Config.BOOKING_URL,\n                new Response.Listener<String>(){\n                    @Override\n                    public void onResponse(String response) {\n                        System.out.println(\"BOOKINGS: \" + response);\n                        JSONArray tickets;\n                        try {\n                            JSONObject jsonObject = new JSONObject(response);\n                            tickets = jsonObject.getJSONArray(\"tickets\");\n                            mDatabaseAdapter.clearDatabase();\n\n                            for (int i = 0; i < tickets.length(); i++){\n                                JSONObject ticket = tickets.getJSONObject(i);\n                                    long id = mDatabaseAdapter.insertData(\n                                            ticket.getString(\"id\"),\n                                            ticket.getString(\"ticket_number\"),\n                                            ticket.getString(\"txt_name\"),\n                                            ticket.getString(\"age\"),\n                                            ticket.getString(\"departure_date\"),\n                                            ticket.getString(\"departure_time\"),\n                                            ticket.getString(\"ticket_status\"),\n                                            0,\n                                            ticket.getString(\"ticket_status\"),\n                                            0);\n                                    if (id > 1) {\n                                        mTotalTickets += 1;\n                                    }\n                                    System.out.println(\"TICKET: \" + ticket.getString(\"ticket_number\"));\n                                }\n                        } catch (JSONException e) {\n                            System.out.println(\"TICKETS ERRORS: \" + e.getMessage());\n                            e.printStackTrace();\n                        }\n                    }\n                },\n                new Response.ErrorListener() {\n                    @Override\n                    public void onErrorResponse(VolleyError error) {\n                        //You can handle error here if you wan\n\n                        //Toast.makeText(mContext, error.toString(), Toast.LENGTH_LONG).show();\n                        System.out.println(error.toString());\n                    }\n                }){\n            @Override\n            protected Map<String, String> getParams() throws AuthFailureError {\n\n                Map<String,String> params = new HashMap<>();\n                //Adding parameters to request\n                params.put(\"date\", formattedDate);\n                params.put(\"route\", route_id);\n                params.put(\"time\", route_departure_time);\n                params.put(\"operator\", operator);\n                params.put(\"pin\", pin);\n                System.out.println(\"Scan parameters: \" + params);\n                //returning parameter\n                return params;\n            }\n            @Override\n            public Map<String, String> getHeaders() throws AuthFailureError {\n                Map<String,String> headers = new HashMap<>();\n                // add headers <key,value>\n                String credentials = Config.API_USER_NAME + \":\" + Config.API_PASSWORD;\n                String auth = \"Basic \" + Base64.encodeToString(credentials.getBytes(), Base64.NO_WRAP);\n                headers.put(\"Authorization\", auth);\n                return headers;\n            }\n        };\n\n        //Adding the string request to the queue\n        RequestQueue requestQueue = Volley.newRequestQueue(this);\n        stringRequest.setRetryPolicy(new DefaultRetryPolicy(\n                40000,\n                DefaultRetryPolicy.DEFAULT_MAX_RETRIES,\n                DefaultRetryPolicy.DEFAULT_BACKOFF_MULT)\n        );\n        requestQueue.add(stringRequest);\n    }\n\n    private void childDialog(String ticket_age){\n        TextView _ticket_age;\n        childDialog = new Dialog(this);\n        childDialog.requestWindowFeature(Window.FEATURE_NO_TITLE);\n        childDialog.setContentView(R.layout.dialog_child);\n        _ticket_age = childDialog.findViewById(R.id.tv_ticket_age);\n        _ticket_age.setText(ticket_age);\n        childDialog.setCancelable(false);\n        childDialog.setCanceledOnTouchOutside(true);\n        childDialog.show();\n\n    }\n\n}\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/rahisi/zffboarding/MainActivity.java b/app/src/main/java/com/rahisi/zffboarding/MainActivity.java
--- a/app/src/main/java/com/rahisi/zffboarding/MainActivity.java	(revision 9799db243374a5f1bf1a504cd99b3ec74efbc88c)
+++ b/app/src/main/java/com/rahisi/zffboarding/MainActivity.java	(date 1763369977958)
@@ -253,6 +253,7 @@
                 System.out.println("Sound starts here");
                 mTicketNumberDisplay.setText("Result");
                 if(event.getCodeId().toLowerCase().equals("j")) {
+                    System.out.println("HERE NOW " + event.getCodeId());
                     searchTicket(event.getBarcodeData());
                 }else if (event.getCodeId().toLowerCase().equals("s")){
                    extractTicketNumberFromQRCode(event.getBarcodeData());
@@ -329,7 +330,7 @@
             try {
                 JSONObject jsonObject = new JSONObject(qrdata);
                 JSONObject ticket = jsonObject.getJSONObject("Ticket");
-                System.out.println("Ticket Data here: " + ticket);
+                System.out.println("Ticket Data here: " + qrdata);
                 qr_ticket_number = ticket.get("Ticket Number").toString();
                 qr_departure_date =  ticket.get("Departure Date").toString();
                 qr_departure_time =  ticket.get("Departure Time").toString();
@@ -705,7 +706,8 @@
                                         return;
                                     }
                                     else  if (responseData.getInt(Config.RESPONSE_CODE) == 200){
-                                        mScannedTickets += 1;                                        Config.doVibration(MainActivity.this);
+                                        mScannedTickets += 1;
+                                        Config.doVibration(MainActivity.this);
                                         playSound(R.raw.success_beep);
                                         if(Objects.equals(qr_name, null)){
                                             mPassengerNameDisplay.setText(R.string.ticket_valid);
Index: app/src/main/java/com/rahisi/zffboarding/Config.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.rahisi.zffboarding;\n\nimport android.content.Context;\nimport android.os.Build;\nimport android.os.VibrationEffect;\nimport android.os.Vibrator;\n\npublic class Config {\n\n    /* Logs EndPoint */\n    static String logsEndpoint = \"https://172.19.255.4/api/\";\n\n    /* Online EndPoint */\n//    static String  app_ip = \"https://booking.zff.co.tz/api/scanner/\";\n\n    /* Demo EndPoint */\n//    static String  app_ip = \"https://demo.zanzibarfastferries.com/api/scanner/\";\n//    static String  app_ip = \"https://ferries.rahisi.co.tz/api/scanner/\";\n\n    /* Local EndPoints */\n    static String  app_ip = \"http://172.16.10.217:2019/scanner/\";   // Vicent\n//    static String  app_ip = \"http://172.16.10.164:7800/scanner/\";   // John\n//    static String logsEndpoint = \"http://172.16.10.143:8052/api/\";\n\n    public static final String LOGIN_URL = app_ip + \"scanner_login.php\";\n    public static final String LOGOUT_URL = app_ip + \"scanner_logout.php\";\n    public static final String BOOKING_URL = app_ip + \"scanner_fetch_bookings.php\";\n    public static final String UPDATE_TICKET_URL = app_ip + \"customerboardingchecking\";\n    public static final String FIND_TICKET_URL = app_ip + \"scanner_get_ticket.php\";\n    public static final String VERIFY_TICKET_URL = app_ip + \"scanner_verify_ticket.php\";\n    public static final String REPORT_ERROR_LOG = logsEndpoint + \"issues_reporting/error_reporting.php\";\n\n\n    public static final String API_USER_NAME = \"goandroy\";\n    public static final String API_PASSWORD = \"12345\";\n    public static final String API_KEY = \"D6H8SKKRL79RJ4WWP5LASYNGJ\";\n    public static final String API_KEY_NAME = \"API-KEY\";\n\n    //Keys for operator id and password as defined in our $_POST['key'] in login.php\n    public static final String KEY_OPERATOR = \"operator\";\n    public static final String KEY_PASSWORD = \"password\";\n\n    //Keys for operator id and password as defined in our $_POST['key'] in login.php\n    public static final String KEY_OPERATOR_NAME = \"operator_name\";\n    public static final String KEY_STATUS = \"status\";\n    public static final String USER_PORT_NAME = \"user_port_id\";\n    public static final String USER_DEVICE_NAME = \"user_device_id\";\n\n    //If server response is equal to this that means login is successful\n    public static final String LOGIN_SUCCESS = \"success\";\n    public static final String LOGOUT_SUCCESS = \"You have successfully logged out\";\n\n    //Keys for Sharedpreferences\n    //This would be the name of our shared preferences\n    public static final String SHARED_PREF_NAME = \"operator_login\";\n    //This would be used to store the operator id of current logged in user\n    public static final String OPERATOR_SHARED_PREF = \"operator\";\n    public static final String ROUTE_SHARED_PREF = \"route\";\n    //We will use this to store the boolean in sharedpreference to track user is loggedin or not\n    public static final String LOGGEDIN_SHARED_PREF = \"loggedin\";\n    // Used to store the name of the currently logged in operator\n    public static final String OPERATOR_NAME_SHARED_PREF = \"operator_name\";\n    public static final String OPERATOR_TYPE_SHARED_PREF = \"operator_type\";\n\n    // OFFLINE DATABASE CONFIGURATIONS\n    public static final String TICKET_DATABASE_NAME = \"zanfastTicketsDb\";\n    public static final String TICKET_TABLE_NAME = \"zanfastTikets\";\n    public static final int TICKET_DATABASE_VERSION = 3;\n    public static final String TICKET_ID = \"id\";\n    public static final String BOOKING_ID = \"booking_id\";\n    public static final String TICKET_NUMBER = \"ticket_id\";\n    public static final String PASSENGER_NAME = \"name\";\n    public static final String PASSENGER_AGE = \"age\";\n    public static final String DEPARTURE_DATE = \"journey_date\";\n    public static final String DEPARTURE_TIME = \"departure_time\";\n    public static final String BOARDING = \"boarding\";\n    public static final String TICKET_SCANNED = \"ticket_scanned\";\n    public static final String TICKET_STATUS = \"status\";\n    public static final String RESPONSE_CODE = \"code\";\n    public static final String TICKET_SCAN_COUNT = \"scan_count\";\n\n    public static final String SHARED_TOTAL_TICKETS = \"total_tickets\";\n    public static final String SHARED_SCANNED_TICKETS = \"scanned_tickets\";\n    public static final String SHARED_DEPARTURE_DATE = \"departure_date\";\n    public static final String SHARED_USER_PORT_NAME = \"user_port_id\";\n    public static final String SHARED_USER_DEVICE_NAME = \"user_device_id\";\n\n    public static final String DEFAULT_LANGUAGE = \"en\";\n\n    public  static String getSerialNo(){\n        String serial = Build.SERIAL;\n        return serial;\n    }\n\n    public static void doVibration(Context context){\n        Vibrator v = (Vibrator) context.getSystemService(Context.VIBRATOR_SERVICE);\n        if(Build.VERSION.SDK_INT >= Build.VERSION_CODES.O){\n            v.vibrate(VibrationEffect.createOneShot(500, VibrationEffect.DEFAULT_AMPLITUDE));\n//            v.vibrate(VibrationEffect.createWaveform(new long[]{0, 500, 1000, 500}, -1));\n        }else{\n            v.vibrate(500);\n        }\n    }\n}\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app/src/main/java/com/rahisi/zffboarding/Config.java b/app/src/main/java/com/rahisi/zffboarding/Config.java
--- a/app/src/main/java/com/rahisi/zffboarding/Config.java	(revision 9799db243374a5f1bf1a504cd99b3ec74efbc88c)
+++ b/app/src/main/java/com/rahisi/zffboarding/Config.java	(date 1763730586573)
@@ -15,10 +15,10 @@
 
     /* Demo EndPoint */
 //    static String  app_ip = "https://demo.zanzibarfastferries.com/api/scanner/";
-//    static String  app_ip = "https://ferries.rahisi.co.tz/api/scanner/";
+    static String  app_ip = "https://ferries.rahisi.co.tz/api/scanner/";
 
     /* Local EndPoints */
-    static String  app_ip = "http://172.16.10.217:2019/scanner/";   // Vicent
+//    static String  app_ip = "http://172.16.10.217:2019/scanner/";   // Vicent
 //    static String  app_ip = "http://172.16.10.164:7800/scanner/";   // John
 //    static String logsEndpoint = "http://172.16.10.143:8052/api/";
 
